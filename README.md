# NFL Player Availability Modeling: Weekly Probability + Cap Risk  
### Case Study: New York Giants (2023–2024)

This repository contains a fully reproducible end-to-end workflow for predicting weekly NFL player availability and converting those probabilities into expected salary-cap dollars at risk.  
The project was developed for Duke MQM DS04, but is structured as if it were being delivered to an NFL analytics department for real operational use.

---

## 1. Project Overview

**Goal**  
Predict the probability that each player will play in a given week, and translate that probability into expected weekly cap exposure to support roster decisions, IR planning, and contingency budgeting.

**Motivation**  
Front offices must make decisions (practice reps, elevations, waivers, emergency signings) under uncertainty. A player who is unlikely to play may represent millions of dollars of weekly cap exposure, and the team benefits from having a quantified risk signal rather than relying on qualitative injury reports.

Example:  
A starter with a $12M cap hit who is only 60% likely to play creates:

(1 - 0.60) × ($12M / 18 weeks) ≈ $266,667 expected weekly cap at risk

yaml
Copy code

---

## 2. Key Results

| Metric | GLM (Calibrated) | Random Forest (Calibrated) |
|--------|------------------|----------------------------|
| **Holdout AUC on 2024** | 0.905 | 0.942 |
| **Recommended operating threshold** | — | 0.88 (≈90% sensitivity) |
| **Average weekly cap flagged as “at risk”** | — | \$1.94M per week |
| **Peak weekly exposure** | — | Week 8 — ≈ \$4.2M |
| **Highest-risk positions (cap at risk)** | OL, DL, CB | OL, DL, CB |
| **Lowest predictability (AUC)** | RB, ST, TE | RB, ST, TE |

All plots and CSVs referenced in the final report are generated automatically by the project script and saved to:

visuals/ # PNG figures
artifacts/ # CSV tables

---

## 3. How to Reproduce the Full Pipeline

### Step 1 — Clone repository
```bash
git clone https://github.com/yourusername/nyg-availability-model.git
cd nyg-availability-model
Step 2 — Restore R environment
r
Copy code
install.packages("renv")
renv::restore()
This installs the exact package versions used in the original run.

Step 3 — Run the full workflow
r
Copy code
source("scripts/nyg_availability_visual_pack_weekly_cap.R")
This script will:

Train GLM and Random Forest on 2023

Evaluate on 2024 (no leakage)

Apply Platt calibration

Compute weekly cap-risk metrics

Create all visualizations and CSV outputs

Optionally generate a PowerPoint deck if officer is installed

No manual editing is required. All outputs are generated programmatically.

5. Modeling Details
Target variable

ini
Copy code
did_play = 1 if snaps_total > 0, else 0
Feature families (all leakage-controlled)

Category	Examples
Lagged usage	snaps_lag1, snaps_lag2, touches_lag1, tackles_lag1
Rolling windows	snaps_roll3, touches_roll5, qb_hits_roll3
Context	rest_days, short_week, home_game, age, bmi
Weather/surface	roof, temp_f, windy_flag
Economics (not used for modeling)	cap_hit_weekly = cap_hit / number_of_regular_season_weeks

Validation strategy

Stage	Method
In-season validation (2023)	Rolling-origin cross-validation (train weeks < w, test week w)
Final evaluation	Train on all of 2023 → predict all of 2024
Calibration	Platt scaling fit on 2023 and applied to 2024

The Random Forest clearly outperforms the GLM on discrimination while maintaining acceptable calibration after scaling.

6. Cap Risk Calculation
ini
Copy code
expected_cap_risk = (1 − predicted_prob_play) × weekly_cap_hit
Cap hits are normalized to a weekly value rather than used as annual totals, which allows decisions to be evaluated on the same cadence as roster planning.

Outputs include:

Cap risk by position

Cap risk by player

Team-level cap exposure over time

Threshold-based trade-off curves (sensitivity vs cap flagged out)

7. Visuals Generated by the Script
Description	Filename
Rolling CV AUC (2023)	cv_rolling_auc_2023.png
ROC curve (2024, calibrated)	roc_calibrated_2024.png
PR curve (2024, calibrated)	pr_calibrated_2024.png
Calibration diagnostics (4 total)	reliability_*.png
Cap risk by position	cap_at_risk_by_position_2024.png
Top 15 player-weeks by risk	top15_cap_risk_players_2024.png
Weekly team cap exposure	weekly_cap_risk_2024.png
Threshold sweeps (3 plots)	threshold_*.png
AUC by position	auc_by_position_2024_bar.png

All figures are saved to visuals/ when the script runs.

8. Scalability to Other Teams
This project is team-specific in data, not in logic.
To apply the framework to another NFL roster:

Replace input modeling file with another team’s weekly roster usage + cap table.

Run the same script without modification.

Outputs will update automatically for the new team.

Nothing in the modeling pipeline is hard-coded to the Giants.

9. Future Extensions
Area	Example Improvement
Data inputs	Practice participation, GPS load, travel fatigue, illness reports
Model variants	XGBoost, calibrated GBDT, monotonic RF constraints
Deployment	Automated weekly job, Slack/Teams alerts, Shiny dashboard
Scale	Multi-team or leaguewide expected cap-risk database

10. Contact
For academic replication, see Appendix C of the written report.
For analytics discussions or applied NFL usage:

scss
Copy code
crpatten88@gmail.com / cp420@duke.edu
X / Twitter: @CPatFBAnalytics
csharp
Copy code
This repository is the technical artifact supporting:
"Predicting Weekly Player Availability and Expected Cap Dollars at Risk"
Duke MQM, DS04 – Fall 2025
